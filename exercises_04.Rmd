---
title: "Data Visualization Exercises: 4"
author: "Kieran Healy"
date: "8/3/2020"
output: distill::distill_article
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## 1 Overview 

Practising summaries, faceting, and layers. 

## 2 Setup

- **Load** the libraries required for the analysis. Create an R code chunk that runs this code:

```{r libraries}

library(tidyverse)
library(colorspace)
library(socviz)

## If demog is not installed uncomment and run these two lines:
## drat::addRepo("kjhealy")
## install.packages("demog")

library(demog)

library(nycdogs)
library(sf)

```

## 3 New York City Dog Names

```{r theme}
theme_nymap <- function(base_size=9, base_family="") {
    require(grid)
    theme_bw(base_size=base_size, base_family=base_family) %+replace%
        theme(axis.line=element_blank(),
              axis.text=element_blank(),
              axis.ticks=element_blank(),
              axis.title=element_blank(),
              panel.background=element_blank(),
              panel.border=element_blank(),
              panel.grid=element_blank(),
              panel.spacing=unit(0, "lines"),
              plot.background=element_blank(),
              legend.justification = c(0,0),
              legend.position = c(0.1, 0.6), 
              legend.direction = "horizontal"
        )
}

```

```{r gss}
nyc_license

boro_names <- c("Manhattan", "Queens", 
                "Brooklyn", "Bronx", 
                "Staten Island")
no_name <- c("Unknown", "Name Not Provided")

```

- Try making a table of the most popular dog names in the city as a whole, and then by borough.
- Add percentages (i.e., relative popularity of all names). 
- Make a Cleveland dotplot of popular dog names faceted by borough.

Hints: 

- Not everyone fills out their borough correctly, and not every dog has a name. The `boro_names` and `no_name` vectors will help you filter your data. 
- To boil the table down to the top 5 or 10 names in each borough, take a look at the `top_n()` function in the help.

## 4 Mapping the Dogs

Here's some code to draw a version of the map I showed in the slides today:

```{r dogmap}
nyc_fb <- nyc_license %>%
    group_by(zip_code, breed_rc) %>%
    tally() %>%
    ungroup() %>%
    complete(zip_code, breed_rc, 
             fill = list(n = 0)) %>%
    mutate(freq = n / sum(n),
           pct = round(freq*100, 2)) %>%
    filter(breed_rc == "French Bulldog")

nyc_fb

```

```{r dogmap2, fig.height = 8, fig.width = 12, layout="l-screen-inset"}
fb_map <- left_join(nyc_zips, nyc_fb)

fb_map %>% ggplot(mapping = aes(fill = pct)) +
    geom_sf(color = "gray80", size = 0.1) +
    scale_fill_continuous_sequential(palette = "Oranges") +
   labs(fill = "Percent of All Licensed Dogs in the City") +
  annotate(geom = "text", x = -74.145 + 0.029, y = 40.82-0.012, 
           label = "New York City's French Bulldogs", size = 6) + 
  annotate(geom = "text", x = -74.1178, y = 40.7955, 
           label = "By Zip Code. Based on Licensing Data", size = 5) + 
    theme_nymap() + 
    guides(fill = guide_legend(title.position = "top", 
                               label.position = "bottom",
                             keywidth = 1, nrow = 1))


```


- Try drawing a similar map showing the relative prevalence of a different breed of dog
- Try drawing a similar map showing the relative popularity of a particular dog name

## 4 Knit the document as an HTML, PDF

- Once you've written your code, knit your document.
